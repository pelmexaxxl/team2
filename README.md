# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ YandexGPT

## ‚úÖ –°–¥–µ–ª–∞–Ω–æ

- [x] –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `analytics.py` —Å –≤—ã–∑–æ–≤–æ–º YandexGPT
- [x] –ó–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `.env` —á–µ—Ä–µ–∑ `configs.py`

   ```
   YANDEX_API_KEY=your-yandex-api-key
   DATABASE_URL=postgresql://user:password@host/dbname
   ADMIN_USER_ID=123456789
   ```

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `analyze_chat_messages` (–≤—ã–±–æ—Ä–∫–∞, –∞–Ω–∞–ª–∏–∑, –∑–∞–ø–∏—Å—å –≤ –ë–î)
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∞–Ω–∞–ª–∏–∑–∞
   ```
    CREATE TABLE chat_settings (
      chat_id BIGINT PRIMARY KEY,
      collect_messages BOOLEAN NOT NULL DEFAULT false,
      last_analyzed TIMESTAMP
    );

    CREATE TABLE messages (
      id BIGINT PRIMARY KEY,
      chat_id BIGINT NOT NULL,
      user_id BIGINT NOT NULL REFERENCES users(tg_id),
      username VARCHAR(64),
      content TEXT NOT NULL,
      created_at TIMESTAMP NOT NULL DEFAULT NOW()
    );

    CREATE TABLE chat_analytics (
      id BIGINT PRIMARY KEY,
      chat_id BIGINT NOT NULL,
      analyzed_at TIMESTAMP NOT NULL DEFAULT NOW(),
      result TEXT NOT NULL
    );
   ```

- [x] –°–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handlers/analyze.py` —Å –∫–æ–º–∞–Ω–¥–æ–π `/analyze_chat`
- [x] –°–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handlers/message_collector.py` –¥–ª—è —Å–±–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–∞—Ö
- [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –≤ `main.py` —á–µ—Ä–µ–∑ `include_router`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ asyncpg, aiohttp, dotenv –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

### –ë–∞–∑–æ–≤—ã–µ

* **`/start`** (–õ–°, –≤—Å–µ) ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ.
* **`/help`** (–≥—Ä—É–ø–ø–∞ / –õ–°, –≤—Å–µ) ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ –∏ —Å–ø–∏—Å–æ–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–±–æ—Ä–æ–º –∏ –∞–Ω–∞–ª–∏–∑–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π (–≥—Ä—É–ø–ø—ã)

* **`/start_collecting`** (HR / Admin) ‚Äî –≤–∫–ª—é—á–∏—Ç—å –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∞–Ω–Ω–æ–º —á–∞—Ç–µ.
* **`/stop_collecting`** (HR / Admin) ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π.
* **`/analyze_chat`** (–≤—Å–µ) ‚Äî –ò–ò-–∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π —ç—Ç–æ–≥–æ —á–∞—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á.
* **`/ask_chat_gpt [—á–∞—Å—ã]`** (–≤—Å–µ) ‚Äî –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å Yandex GPT –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º —á–∞—Ç–∞ –∑–∞ N —á–∞—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 24).
* **`/analyze_all_chats`** (Admin) ‚Äî –∞–Ω–∞–ª–∏–∑ —Å—Ä–∞–∑—É –ø–æ –≤—Å–µ–º —á–∞—Ç–∞–º.

### –û–ø—Ä–æ—Å—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ

* **`/create_poll`** (HR / Admin, –õ–°) ‚Äî –º–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞. __–°—Ç—Ä–∞–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç__
* **`/save_template`** (HR / Admin, –õ–°) ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —á–µ—Ä–Ω–æ–≤–∏–∫ –æ–ø—Ä–æ—Å–∞ –∫–∞–∫ —à–∞–±–ª–æ–Ω. *(–Ω–æ–≤–æ–µ)* ?
* **`/use_template <id>`** (HR / Admin, –õ–°) ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω –æ–ø—Ä–æ—Å–∞ –ø–æ ID. *(–Ω–æ–≤–æ–µ)* ?
* **`/send_poll`** (HR, –õ–°) ‚Äî —Ä–∞–∑–æ—Å–ª–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–ø—Ä–æ—Å –≤—Å–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º.
* **`/poll_<id>`** (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è) ‚Äî –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É ID.
* **`/results`** (HR, –õ–°) ‚Äî —Ç–µ–∫—Å—Ç–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –æ–ø—Ä–æ—Å—É.
* **`/chart_results`** (HR / Admin, –õ–°) ‚Äî PNG-–¥–∏–∞–≥—Ä–∞–º–º–∞ –∏—Ç–æ–≥–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–ø—Ä–æ—Å–∞. *(–Ω–æ–≤–æ–µ)*
* **`/my_dynamics`** (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –õ–°) ‚Äî –ª–∏—á–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–∏. *(–Ω–æ–≤–æ–µ)*
* **`/analis`** (HR, –õ–°) ‚Äî –±—ã—Å—Ç—Ä–∞—è —Å–≤–æ–¥–∫–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä—É–ø–ø

* **`/set_welcome <—Ç–µ–∫—Å—Ç>`** (HR / Admin, –≥—Ä—É–ø–ø–∞) ‚Äî –∑–∞–¥–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ; –≤ —Ç–µ–∫—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `{user}` –¥–ª—è –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–º–µ–Ω–∏. *(–Ω–æ–≤–æ–µ)*

### –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç

* **`/cabinet`** (–õ–° / –≥—Ä—É–ø–ø–∞, –≤—Å–µ) ‚Äî –æ—Ç–∫—Ä—ã—Ç—å inline-–º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º; –Ω–∞–±–æ—Ä –ø—É–Ω–∫—Ç–æ–≤ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–æ–ª–∏. *(–Ω–æ–≤–æ–µ)*


> *¬´–Ω–æ–≤–æ–µ¬ª* ‚Äî –∫–æ–º–∞–Ω–¥—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â–µ–º —Ä–µ–ª–∏–∑–µ.
> –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –æ—Å–Ω–æ–≤—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Ä–æ–ª—è—Ö `EMPLOYEE`, `HR`, `ADMIN`, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –≤ –º–æ–¥–µ–ª–∏ `User`.


### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —á–∞—Ç—ã —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º —Å–±–æ—Ä–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 23:00 –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## üî≤ –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### üì¶ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env.example` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [x] –î–æ–±–∞–≤–∏—Ç—å `chat_analytics` –∏ –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ Alembic –º–∏–≥—Ä–∞—Ü–∏—é

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [x] –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/analyze_all_chats` —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ user_id (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### ‚è± –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 23:00)
- [ ] –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –≤ Telegram-—á–∞—Ç/–∞–¥–º–∏–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

# *Structure*

```
team2
‚îú‚îÄ Dockerfile
‚îú‚îÄ README.md
‚îú‚îÄ docker-compose.yml
‚îú‚îÄ logs
‚îÇ  ‚îî‚îÄ bot_log.log
‚îú‚îÄ requirements.txt
‚îî‚îÄ src
   ‚îú‚îÄ alembic
   ‚îÇ  ‚îú‚îÄ README
   ‚îÇ  ‚îú‚îÄ env.py
   ‚îÇ  ‚îú‚îÄ script.py.mako
   ‚îÇ  ‚îî‚îÄ versions
   ‚îÇ     ‚îú‚îÄ __pycache__
   ‚îÇ     ‚îÇ  ‚îî‚îÄ d1c5e7ce77ed_initial.cpython-312.pyc
   ‚îÇ     ‚îî‚îÄ d1c5e7ce77ed_initial.py
   ‚îú‚îÄ alembic.ini
   ‚îú‚îÄ app
   ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îú‚îÄ configs.py
   ‚îÇ  ‚îú‚îÄ db
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ db.py
   ‚îÇ  ‚îú‚îÄ db.py
   ‚îÇ  ‚îú‚îÄ handlers
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ admin.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ analyze.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ respond.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ user.py
   ‚îÇ  ‚îú‚îÄ main.py
   ‚îÇ  ‚îú‚îÄ middlewares
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ db.py
   ‚îÇ  ‚îú‚îÄ models
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ base.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ user.py
   ‚îÇ  ‚îú‚îÄ services
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ admin.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ analytics.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ poll_manager.py
   ‚îÇ  ‚îî‚îÄ utils
   ‚îÇ     ‚îú‚îÄ __init__.py
   ‚îÇ     ‚îú‚îÄ emotions.py
   ‚îÇ     ‚îî‚îÄ questions.py
   ‚îî‚îÄ table_structure.sql

```
