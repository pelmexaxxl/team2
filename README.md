# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ YandexGPT

## ‚úÖ –°–¥–µ–ª–∞–Ω–æ

- [x] –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `analytics.py` —Å –≤—ã–∑–æ–≤–æ–º YandexGPT
- [x] –ó–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `.env` —á–µ—Ä–µ–∑ `configs.py`

   ```
   YANDEX_API_KEY=your-yandex-api-key
   DATABASE_URL=postgresql://user:password@host/dbname
   ADMIN_USER_ID=123456789
   ```

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `analyze_chat_messages` (–≤—ã–±–æ—Ä–∫–∞, –∞–Ω–∞–ª–∏–∑, –∑–∞–ø–∏—Å—å –≤ –ë–î)
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∞–Ω–∞–ª–∏–∑–∞
   ```
    CREATE TABLE chat_settings (
      chat_id BIGINT PRIMARY KEY,
      collect_messages BOOLEAN NOT NULL DEFAULT false,
      last_analyzed TIMESTAMP
    );

    CREATE TABLE messages (
      id BIGINT PRIMARY KEY,
      chat_id BIGINT NOT NULL,
      user_id BIGINT NOT NULL REFERENCES users(tg_id),
      username VARCHAR(64),
      content TEXT NOT NULL,
      created_at TIMESTAMP NOT NULL DEFAULT NOW()
    );

    CREATE TABLE chat_analytics (
      id BIGINT PRIMARY KEY,
      chat_id BIGINT NOT NULL,
      analyzed_at TIMESTAMP NOT NULL DEFAULT NOW(),
      result TEXT NOT NULL
    );
   ```

- [x] –°–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handlers/analyze.py` —Å –∫–æ–º–∞–Ω–¥–æ–π `/analyze_chat`
- [x] –°–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handlers/message_collector.py` –¥–ª—è —Å–±–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–∞—Ö
- [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –≤ `main.py` —á–µ—Ä–µ–∑ `include_router`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ asyncpg, aiohttp, dotenv –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è

## üìã –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª: –°–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

- `/start_collecting` - –ù–∞—á–∞—Ç—å —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ç–µ–∫—É—â–µ–º —á–∞—Ç–µ
- `/stop_collecting` - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ç–µ–∫—É—â–µ–º —á–∞—Ç–µ
- `/analyze_chat` - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏
- `/analyze_all_chats` - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ —á–∞—Ç—ã —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º —Å–±–æ—Ä–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 23:00 –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## üî≤ –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### üì¶ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env.example` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [x] –î–æ–±–∞–≤–∏—Ç—å `chat_analytics` –∏ –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ Alembic –º–∏–≥—Ä–∞—Ü–∏—é

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [x] –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/analyze_all_chats` —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ user_id (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### ‚è± –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 23:00)
- [ ] –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –≤ Telegram-—á–∞—Ç/–∞–¥–º–∏–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

# *Structure*

```
team2
‚îú‚îÄ Dockerfile
‚îú‚îÄ README.md
‚îú‚îÄ docker-compose.yml
‚îú‚îÄ logs
‚îÇ  ‚îî‚îÄ bot_log.log
‚îú‚îÄ requirements.txt
‚îî‚îÄ src
   ‚îú‚îÄ alembic
   ‚îÇ  ‚îú‚îÄ README
   ‚îÇ  ‚îú‚îÄ env.py
   ‚îÇ  ‚îú‚îÄ script.py.mako
   ‚îÇ  ‚îî‚îÄ versions
   ‚îÇ     ‚îú‚îÄ __pycache__
   ‚îÇ     ‚îÇ  ‚îî‚îÄ d1c5e7ce77ed_initial.cpython-312.pyc
   ‚îÇ     ‚îî‚îÄ d1c5e7ce77ed_initial.py
   ‚îú‚îÄ alembic.ini
   ‚îú‚îÄ app
   ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îú‚îÄ configs.py
   ‚îÇ  ‚îú‚îÄ db
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ db.py
   ‚îÇ  ‚îú‚îÄ db.py
   ‚îÇ  ‚îú‚îÄ handlers
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ admin.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ analyze.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ respond.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ user.py
   ‚îÇ  ‚îú‚îÄ main.py
   ‚îÇ  ‚îú‚îÄ middlewares
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ db.py
   ‚îÇ  ‚îú‚îÄ models
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ base.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ user.py
   ‚îÇ  ‚îú‚îÄ services
   ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ admin.py
   ‚îÇ  ‚îÇ  ‚îú‚îÄ analytics.py
   ‚îÇ  ‚îÇ  ‚îî‚îÄ poll_manager.py
   ‚îÇ  ‚îî‚îÄ utils
   ‚îÇ     ‚îú‚îÄ __init__.py
   ‚îÇ     ‚îú‚îÄ emotions.py
   ‚îÇ     ‚îî‚îÄ questions.py
   ‚îî‚îÄ table_structure.sql

```
